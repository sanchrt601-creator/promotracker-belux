<div id="app"></div>
<script>
let state={country:'BE',selectedStore:'all',promos:[],searchTerm:'',showLegal:false,isAdmin:false,showAdminLogin:false,lastUpdate:null,refreshing:false};
const stores={BE:['Delhaize','Colruyt','Carrefour','Aldi','Lidl','Renmans','IntermarchÃ©'],LU:['Delhaize','Colruyt','Aldi','Lidl','Auchan','Leclerc','Cactus']};
async function loadPromosFromStorage(){const stored=localStorage.getItem('promos-data');if(stored){const data=JSON.parse(stored);state.promos=data.promos||[];state.lastUpdate=data.lastUpdate||null;}}
function savePromosToStorage(promos){const data={promos:promos,lastUpdate:new Date().toISOString()};localStorage.setItem('promos-data',JSON.stringify(data));state.lastUpdate=data.lastUpdate;}
function handleAdminLogin(){const password=document.getElementById('admin-password').value;if(password==='admin2025'){state.isAdmin=true;state.showAdminLogin=false;render();}else{alert('Mot de passe incorrect');}}
function handleAdminLogout(){state.isAdmin=false;render();}
function generatePromos(){if(!state.isAdmin){alert('Seul l\'administrateur peut rafraÃ®chir');return;}state.refreshing=true;render();setTimeout(()=>{const sampleProducts=[{product:'Coca-Cola 2L',normal:'2.99â‚¬',promo:'1.99â‚¬',discount:'-33%'},{product:'Pain de mie',normal:'1.89â‚¬',promo:'0.99â‚¬',discount:'-48%'},{product:'Lait 1L',normal:'1.29â‚¬',promo:'0.89â‚¬',discount:'-31%'},{product:'Yaourt x8',normal:'2.49â‚¬',promo:'1.79â‚¬',discount:'-28%'},{product:'PÃ¢tes 500g',normal:'1.19â‚¬',promo:'0.79â‚¬',discount:'-34%'},{product:'Huile olive 1L',normal:'8.99â‚¬',promo:'5.99â‚¬',discount:'-33%'},{product:'CafÃ© 250g',normal:'3.99â‚¬',promo:'2.99â‚¬',discount:'-25%'},{product:'Biscuits',normal:'2.79â‚¬',promo:'1.99â‚¬',discount:'-29%'},{product:'Fromage 500g',normal:'3.49â‚¬',promo:'2.49â‚¬',discount:'-29%'},{product:'Chips 250g',normal:'2.19â‚¬',promo:'1.49â‚¬',discount:'-32%'},{product:'Riz 1kg',normal:'2.29â‚¬',promo:'1.59â‚¬',discount:'-31%'},{product:'Thon x3',normal:'4.99â‚¬',promo:'3.49â‚¬',discount:'-30%'}];const newPromos=[];const allStores=[...new Set([...stores.BE,...stores.LU])];allStores.forEach(store=>{const numProducts=Math.floor(Math.random()*2)+3;const shuffled=[...sampleProducts].sort(()=>Math.random()-0.5);for(let i=0;i<numProducts;i++){const product=shuffled[i];const countries=[];if(stores.BE.includes(store))countries.push('BE');if(stores.LU.includes(store))countries.push('LU');const daysUntil=Math.floor(Math.random()*8)+3;const startDate=new Date();const endDate=new Date();endDate.setDate(endDate.getDate()+daysUntil);const validFrom=startDate.toLocaleDateString('fr-BE');const validUntil=endDate.toLocaleDateString('fr-BE');countries.forEach(c=>{newPromos.push({id:`${store}-${c}-${i}-${Date.now()}-${Math.random()}`,store:store,product:product.product,normalPrice:product.normal,promoPrice:product.promo,discount:product.discount,validFrom:validFrom,validUntil:validUntil,country:c});});}});state.promos=newPromos;savePromosToStorage(newPromos);state.refreshing=false;alert(`âœ… ${newPromos.length} promos gÃ©nÃ©rÃ©es!`);render();},1500);}
function getFilteredPromos(){return state.promos.filter(promo=>{const matchCountry=promo.country===state.country;const matchStore=state.selectedStore==='all'||promo.store===state.selectedStore;const matchSearch=promo.product.toLowerCase().includes(state.searchTerm.toLowerCase());return matchCountry&&matchStore&&matchSearch;});}
function formatDate(isoDate){if(!isoDate)return'Jamais';const date=new Date(isoDate);return date.toLocaleString('fr-BE',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});}
function render(){const app=document.getElementById('app');const filteredPromos=getFilteredPromos();app.innerHTML=`<div class="bg-white shadow-lg"><div class="max-w-7xl mx-auto px-4 py-6"><div class="flex items-center justify-between flex-wrap gap-4"><div class="flex items-center gap-3"><svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg><h1 class="text-2xl md:text-3xl font-bold text-gray-800">PromoTracker</h1></div><div class="flex gap-2 items-center">${state.isAdmin?`<button onclick="generatePromos()" ${state.refreshing?'disabled':''} class="flex items-center gap-2 px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50 text-sm"><svg class="w-4 h-4 ${state.refreshing?'animate-spin':''}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>${state.refreshing?'...':'Refresh'}</button><button onclick="handleAdminLogout()" class="px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm">DÃ©co</button>`:`<button onclick="state.showAdminLogin=true;render();" class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm">Admin</button>`}</div></div></div></div><div class="max-w-7xl mx-auto px-4 py-6">${state.lastUpdate?`<div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-xs md:text-sm text-gray-700"><span>ğŸ“… MAJ: ${formatDate(state.lastUpdate)}</span></div>`:''}<div class="bg-white rounded-xl shadow-md p-4 md:p-6 mb-6"><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label class="block text-sm font-medium text-gray-700 mb-2">ğŸŒ Pays</label><select onchange="state.country=this.value;render();" class="w-full px-3 py-2 border border-gray-300 rounded-lg"><option value="BE" ${state.country==='BE'?'selected':''}>ğŸ‡§ğŸ‡ª Belgique</option><option value="LU" ${state.country==='LU'?'selected':''}>ğŸ‡±ğŸ‡º Luxembourg</option></select></div><div><label class="block text-sm font-medium text-gray-700 mb-2">ğŸª Magasin</label><select onchange="state.selectedStore=this.value;render();" class="w-full px-3 py-2 border border-gray-300 rounded-lg"><option value="all">Tous</option>${stores[state.country].map(s=>`<option value="${s}" ${state.selectedStore===s?'selected':''}>${s}</option>`).join('')}</select></div><div><label class="block text-sm font-medium text-gray-700 mb-2">ğŸ” Rechercher</label><input type="text" placeholder="Produit..." value="${state.searchTerm}" oninput="state.searchTerm=this.value;render();" class="w-full px-3 py-2 border border-gray-300 rounded-lg"></div></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"><div class="bg-white rounded-lg shadow p-4"><div class="flex items-center justify-between"><div><p class="text-xs text-gray-600">Promos dispo</p><p class="text-2xl font-bold text-indigo-600">${filteredPromos.length}</p></div><span class="text-3xl">ğŸ’°</span></div></div><div class="bg-white rounded-lg shadow p-4"><div class="flex items-center justify-between"><div><p class="text-xs text-gray-600">Magasins</p><p class="text-2xl font-bold text-green-600">${stores[state.country].length}</p></div><span class="text-3xl">ğŸª</span></div></div><div class="bg-white rounded-lg shadow p-4"><div class="flex items-center justify-between"><div><p class="text-xs text-gray-600">Total</p><p class="text-2xl font-bold text-orange-600">${state.promos.length}</p></div><span class="text-3xl">ğŸ›’</span></div></div></div>${state.refreshing?'<div class="text-center py-12"><div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div></div>':filteredPromos.length>0?`<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">${filteredPromos.map(promo=>`<div class="bg-white rounded-xl shadow-md hover:shadow-xl transition"><div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-3"><div class="flex items-center justify-between text-white"><span class="font-semibold text-sm">${promo.store}</span><span class="bg-white text-indigo-600 px-2 py-1 rounded-full text-xs font-bold">${promo.discount}</span></div></div><div class="p-4"><h3 class="text-base font-semibold text-gray-800 mb-2">${promo.product}</h3><div class="space-y-1"><div class="flex items-center justify-between"><span class="text-xs text-gray-500 line-through">${promo.normalPrice}</span><span class="text-xl font-bold text-green-600">${promo.promoPrice}</span></div><div class="text-xs text-gray-500 pt-2 border-t">ğŸ“… ${promo.validFrom} - ${promo.validUntil}</div></div></div></div>`).join('')}</div>`:'<div class="text-center py-12 bg-white rounded-xl shadow"><p class="text-gray-500">'+(state.promos.length===0?"Admin doit rafraÃ®chir":"Aucune promo")+'</p></div>'}</div><div class="bg-white mt-12 border-t"><div class="max-w-7xl mx-auto px-4 py-4 text-center text-xs text-gray-600"><p>âš–ï¸ Service indÃ©pendant - Marques propriÃ©tÃ© de leurs dÃ©tenteurs</p></div></div>${state.showAdminLogin?'<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" style="backdrop-filter:blur(4px)"><div class="bg-white rounded-xl shadow-2xl p-6 max-w-sm w-full"><h2 class="text-xl font-bold text-gray-800 mb-4">Admin</h2><input type="password" id="admin-password" placeholder="Mot de passe" onkeypress="if(event.key===\'Enter\')handleAdminLogin()" class="w-full px-3 py-2 border rounded-lg mb-4"><div class="flex gap-2"><button onclick="handleAdminLogin()" class="flex-1 bg-indigo-600 text-white py-2 rounded-lg">OK</button><button onclick="state.showAdminLogin=false;render();" class="flex-1 border py-2 rounded-lg">Annuler</button></div><p class="text-xs text-gray-500 mt-3 text-center">Pass: admin2025</p></div></div>':''}`;  }
loadPromosFromStorage();render();
</script>
